#:kivy 1.10.0
#:import LibraryScreen kmpc.library.LibraryScreen
#:import listbackdrop kmpc.widgets.listbackdrop

<GeneratePopup@Popup>:
    size_hint_x: 0.8
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            orientation: 'horizontal'
            BaseLabel:
                text: 'Rating'
            Spinner:
                id: ratings_spinner
                text_autoupdate: True
                values: ['None','0','1','2','3','4','5','6','7','8','9','10']
                on_text: app.root.library.update_generate_text(root)
        BoxLayout:
            orientation: 'horizontal'
            BaseLabel:
                text: 'Operation'
            Spinner:
                id: operation_spinner
                text_autoupdate: True
                values: ['<','<=','=','>=','>']
                text: '>='
                on_text: app.root.library.update_generate_text(root)
        BaseButton:
            text: 'Generate synclist'
            on_press: app.root.library.generate_list('synclist',root)
        BoxLayout:
            orientation: 'horizontal'
            BaseLabel:
                text: 'Playlist Name'
            TextInput:
                id: playlist_name
                text: 'No Stars'
        BaseButton:
            text: 'Generate playlist'
            on_press: app.root.library.generate_list('playlist',root)

<BrowserQueuePopup@Popup>:
    size_hint_x: 0.8
    BoxLayout:
        orientation: 'vertical'
        BaseButton:
            text: 'Append to Queue'
            on_press: app.root.library.browser_add(False,False,root)
        BaseButton:
            text: 'Insert into Queue'
            on_press: app.root.library.browser_add(False,True,root)
        BaseButton:
            text: 'Replace Queue'
            on_press: app.root.library.browser_add(True,False,root)

<BrowserStickerPopup@Popup>:
    size_hint_x: 0.8
    BoxLayout:
        orientation: 'vertical'
        BaseButton:
            text: 'Set Rating'
            on_press: app.root.library.library_rating_popup(self,root)
        BaseButton:
            text: 'Set copy_flag=Y'
            on_press: app.root.library.set_copy_flag('Y',root)
        BaseButton:
            text: 'Set copy_flag=N'
            on_press: app.root.library.set_copy_flag('N',root)
        BaseButton:
            text: 'Clear copy_flag'
            on_press: app.root.library.set_copy_flag('',root)

<LibraryRow>:
    canvas.before:
        Color:
            rgba: app.get_color('listitemselected') if self.selected else app.get_color('listitem')
        Rectangle:
            source: listbackdrop
            size: self.size
            pos: self.pos
        Color:
            rgba: (1,1,1,0.3)
        Rectangle:
            size: (self.width,sp(1))
            pos: self.pos
        Rectangle:
            size: (self.width,sp(1))
            pos: (self.x,self.top)
    value: ''
    copy_flag: ''
    rating: ''
    base: 'root'
    level: 'root'
    upto: None
    info: {}
    orientation: 'horizontal'
    spacing: '10sp'
    ScaledWidthLabel:
		font_size: '20sp'
		base_font_size: '20sp'
		minscale: 60
		maxscale: 300
        size_hint_x: 1
        halign: 'left'
        valign: 'center'
        text_size: self.size
        text: root.value
        padding_x: sp(10)
    StarLabel:
        size_hint_x: None
        text: ratingstars[int(root.rating)] if root.rating else ''
    BaseLabel:
        size_hint_x: None
        text: root.copy_flag

<LibraryScreen>:
    name: 'library'
    rv: rv
    rbl: rbl
    current_header: current_header
    BoxLayout:
        orientation: 'vertical'
        padding: 0
        spacing: 0
        ScreenSwitcher:
            manager: root.manager
            id: ss
        BoxLayout:
            size_hint_y: 0.1
            orientation: 'horizontal'
            BaseToggleButton:
                allow_no_selection: False
                group: 'librarytype'
                text: 'Files'
                id: files_button
                on_press: root.change_view_type(self.text)
            BaseToggleButton:
                allow_no_selection: False
                group: 'librarytype'
                text: 'Albums'
                id: albums_button
                on_press: root.change_view_type(self.text)
            BaseToggleButton:
                allow_no_selection: False
                group: 'librarytype'
                text: 'Tracks'
                id: tracks_button
                on_press: root.change_view_type(self.text)
            BaseToggleButton:
                allow_no_selection: False
                group: 'librarytype'
                text: 'Playlists'
                id: playlists_button
                on_press: root.change_view_type(self.text)
            BaseButton:
                text: 'Generate'
                id: generate_button
                on_press: root.popup_generate()
        BaseLabel:
            id: current_header
            size_hint_y: 0.1
            size_hint_x: 1
            padding_x: sp(10)
            text: ''
            text_size: self.size
            halign: 'center'
            valign: 'middle'
        BoxLayout:
            orientation: 'horizontal'
            RecycleView:
                id: rv
                size_hint_y: 1
                size_hint_x: 1
                rv_selection: {}
                scroll_type: ['bars','content']
                bar_width: sp(40)
                viewclass: 'LibraryRow'
                LibraryRecycleBoxLayout:
                    id: rbl
                    default_size_hint: 1, None
                    size_hint_y: None
                    size_hint_min_y: '48sp'
                    height: self.minimum_height
                    orientation: 'vertical'
                    spacing: sp(2)
                    multiselect: True
                    touch_multiselect: True
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: '0.05'
                BaseButton:
                    text: 'Q'
                    on_press: root.browser_queue_popup()
                BaseButton:
                    text: 'S'
                    on_press: root.browser_sticker_popup()

