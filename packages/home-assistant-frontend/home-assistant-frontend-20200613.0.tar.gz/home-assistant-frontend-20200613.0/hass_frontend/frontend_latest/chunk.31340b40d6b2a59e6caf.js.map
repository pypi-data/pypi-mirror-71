{"version":3,"file":"chunk.31340b40d6b2a59e6caf.js","sources":["webpack:///./src/resources/codemirror.ondemand.ts","webpack:///./src/components/ha-yaml-editor.ts"],"sourcesContent":["interface LoadedCodeMirror {\n  codeMirror: any;\n  codeMirrorCss: any;\n}\n\nlet loaded: Promise<LoadedCodeMirror>;\n\nexport const loadCodeMirror = async (): Promise<LoadedCodeMirror> => {\n  if (!loaded) {\n    loaded = import(/* webpackChunkName: \"codemirror\" */ \"./codemirror\");\n  }\n  return loaded;\n};\n","import { safeDump, safeLoad } from \"js-yaml\";\nimport {\n  customElement,\n  html,\n  LitElement,\n  property,\n  query,\n  TemplateResult,\n} from \"lit-element\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { afterNextRender } from \"../common/util/render-status\";\nimport \"./ha-code-editor\";\nimport type { HaCodeEditor } from \"./ha-code-editor\";\n\ndeclare global {\n  // for fire event\n  interface HASSDomEvents {\n    \"editor-refreshed\": undefined;\n  }\n}\n\nconst isEmpty = (obj: object): boolean => {\n  if (typeof obj !== \"object\") {\n    return false;\n  }\n  for (const key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      return false;\n    }\n  }\n  return true;\n};\n\n@customElement(\"ha-yaml-editor\")\nexport class HaYamlEditor extends LitElement {\n  @property() public value?: any;\n\n  @property() public defaultValue?: any;\n\n  @property() public isValid = true;\n\n  @property() public label?: string;\n\n  @property() private _yaml = \"\";\n\n  @query(\"ha-code-editor\") private _editor?: HaCodeEditor;\n\n  public setValue(value): void {\n    try {\n      this._yaml = value && !isEmpty(value) ? safeDump(value) : \"\";\n    } catch (err) {\n      alert(`There was an error converting to YAML: ${err}`);\n    }\n    afterNextRender(() => {\n      if (this._editor?.codemirror) {\n        this._editor.codemirror.refresh();\n      }\n      afterNextRender(() => fireEvent(this, \"editor-refreshed\"));\n    });\n  }\n\n  protected firstUpdated(): void {\n    if (this.defaultValue) {\n      this.setValue(this.defaultValue);\n    }\n  }\n\n  protected render(): TemplateResult {\n    if (this._yaml === undefined) {\n      return html``;\n    }\n    return html`\n      ${this.label ? html` <p>${this.label}</p> ` : \"\"}\n      <ha-code-editor\n        .value=${this._yaml}\n        mode=\"yaml\"\n        .error=${this.isValid === false}\n        @value-changed=${this._onChange}\n      ></ha-code-editor>\n    `;\n  }\n\n  private _onChange(ev: CustomEvent): void {\n    ev.stopPropagation();\n    const value = ev.detail.value;\n    let parsed;\n    let isValid = true;\n\n    if (value) {\n      try {\n        parsed = safeLoad(value);\n      } catch (err) {\n        // Invalid YAML\n        isValid = false;\n      }\n    } else {\n      parsed = {};\n    }\n\n    this.value = parsed;\n    this.isValid = isValid;\n\n    fireEvent(this, \"value-changed\", { value: parsed, isValid } as any);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-yaml-editor\": HaYamlEditor;\n  }\n}\n"],"mappings":"AAKA;ACmEA;;AAEA;;AAEA;AACA;;AA3CA","sourceRoot":""}