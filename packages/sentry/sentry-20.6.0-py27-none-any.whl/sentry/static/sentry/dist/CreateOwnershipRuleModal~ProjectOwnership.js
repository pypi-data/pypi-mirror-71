(window.sntryWpJsonp=window.sntryWpJsonp||[]).push([[20],{2307:function(e,t,n){"use strict";var a=n(8),r=n.n(a),i=n(9),o=n.n(i),l=n(11),c=n.n(l),s=n(12),u=n.n(s),p=n(6),d=n.n(p),f=n(4),h=n(2),b=n.n(h),g=n(1799),m=n.n(g),O=n(54),j=n(149),y=n(128),v=n(32),x=n(31),w=n(3),C=n(637),S=n(159),k=n(249),T=n(46),R=n(27),U=n(391),M=n(20),P=n.n(M),z=n(28),A=n.n(z),I=n(29),D=n.n(I),N=n(17),V=n.n(N),B=n(56),q=n.n(B),L=n(131),W=n.n(L),E=n(39),J=n.n(E),K=n(21),F=n.n(K),H=n(396),Y=n(25),_=n(207),G=n(288),Q=n(5),X=n.n(Q),Z=n(165),$=n(0),ee=b.a.forwardRef((function(e,t){return Object($.f)(Z.a,X()({forwardedRef:t},e,{multiple:!0}))})),te=n(677),ne=n(38);function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){V()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ie(e){return function(){var t,n=d()(e);if(oe()){var a=d()(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return u()(this,t)}}function oe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var le=function(e){c()(n,e);var t=ie(n);function n(){var e;r()(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).handleClick=function(){e.props.onRemove(e.props.value)},e}return o()(n,[{key:"render",value:function(){return Object($.f)("a",{onClick:this.handleClick},Object($.f)(te.a,{actor:this.props.value.actor,size:28}))}}]),n}(b.a.Component);le.displayName="ValueComponent";var ce=function(e){return"".concat(e.email&&e.email.toLowerCase()," ").concat(e.name&&e.name.toLowerCase())},se={name:"fs1hps-SelectOwners",styles:"width:200px;;label:SelectOwners;"},ue=function(e){c()(a,e);var t,n=ie(a);function a(){var e;r()(this,a);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).state={loading:!1,inputValue:""},e.renderUserBadge=function(e){return Object($.f)(G.a,{avatarSize:24,user:e,hideEmail:!0,useLink:!1})},e.createMentionableUser=function(t){return{value:Object(Y.b)(t.id),label:e.renderUserBadge(t),searchKey:ce(t),actor:{type:"user",id:t.id,name:t.name}}},e.createUnmentionableUser=function(t){var n=t.user;return re({},e.createMentionableUser(n),{disabled:!0,label:Object($.f)(de,null,Object($.f)(ne.a,{position:"left",title:Object(w.b)("%s is not a member of project",n.name||n.email)},e.renderUserBadge(n)))})},e.createMentionableTeam=function(e){return{value:Object(Y.a)(e.id),label:Object($.f)(G.a,{team:e}),searchKey:"#".concat(e.slug),actor:{type:"team",id:e.id,name:e.slug}}},e.createUnmentionableTeam=function(t){var n=e.props.organization.access.includes("project:write");return re({},e.createMentionableTeam(t),{disabled:!0,label:Object($.f)(pe,null,Object($.f)(de,null,Object($.f)(ne.a,{position:"left",title:Object(w.b)("%s is not a member of project","#".concat(t.slug))},Object($.f)(G.a,{team:t}))),Object($.f)(ne.a,{title:n?Object(w.b)("Add %s to project","#".concat(t.slug)):Object(w.b)("You do not have permission to add team to project.")},Object($.f)(fe,{size:"zero",borderless:!0,disabled:!n,onClick:e.handleAddTeamToProject.bind(q()(e),t),icon:Object($.f)(R.b,{isCircled:!0})})))})},e.handleChange=function(t){e.props.onChange(t)},e.handleInputChange=function(t){e.setState({inputValue:t}),e.props.onInputChange&&e.props.onInputChange(t)},e.queryMembers=W()((function(t,n){var a=e.props.organization;return e.api?e.api.requestPromise("/organizations/".concat(a.slug,"/members/"),{query:{query:t}}).then((function(e){return n(null,e)}),(function(e){return n(e)})):null}),250),e.handleLoadOptions=function(){var t=e.getMentionableUsers(),n=e.getMentionableTeams(),a=e.getTeamsNotInProject(n),r=t.map((function(e){return e.actor.id}));return new Promise((function(t,n){e.queryMembers(e.state.inputValue,(function(e,a){e?n(e):t(a)}))})).then((function(t){return t?t.filter((function(e){var t=e.user;return t&&-1===r.indexOf(t.id)})).map(e.createUnmentionableUser):[]})).then((function(e){return{options:[].concat(D()(t),D()(n),D()(a),D()(e))}}))},e.api=new O.a,e.projectsStoreMixin=F.a.listenTo(y.a,(function(){e.closeSelectMenu()})),e}return o()(a,[{key:"componentDidMount",value:function(){this.projectsStoreMixin&&this.projectsStoreMixin.componentDidMount()}},{key:"componentWillUnmount",value:function(){this.api=null,this.projectsStoreMixin&&this.projectsStoreMixin.componentWillUnmount()}},{key:"getMentionableUsers",value:function(){return j.a.getAll().map(this.createMentionableUser)}},{key:"getMentionableTeams",value:function(){var e=this.props.project,t=y.a.getBySlug(e.slug);return t?t.teams.map(this.createMentionableTeam):[]}},{key:"getTeamsNotInProject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=_.a.getAll()||[],n=e.map((function(e){return e.actor.id}));return t.filter((function(e){return-1===n.indexOf(e.id)})).map(this.createUnmentionableTeam)}},{key:"closeSelectMenu",value:function(){if(this.selectRef){var e=J.a.findDOMNode(this.selectRef).querySelector(".Select-input input");e&&e.blur()}}},{key:"handleAddTeamToProject",value:(t=A()(P.a.mark((function e(t){var n,a,r,i,o;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,a=n.organization,r=n.project,i=n.value,o=D()(i),this.props.onChange([].concat(D()(this.props.value),[this.createMentionableTeam(t)])),e.prev=3,e.next=6,Object(H.a)(this.api,a.slug,r.slug,t);case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(3),this.props.onChange(o),this.closeSelectMenu();case 12:case"end":return e.stop()}}),e,this,[[3,8]])}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return Object($.f)(ee,{deprecatedSelectControl:!0,filterOptions:function(e,t){return e.filter((function(e){return e.searchKey.indexOf(t)>-1}))},ref:function(t){return e.selectRef=t},loadOptions:this.handleLoadOptions,defaultOptions:!0,async:!0,clearable:!0,disabled:this.props.disabled,cache:!1,valueComponent:le,placeholder:Object(w.b)("owners"),onInputChange:this.handleInputChange,onChange:this.handleChange,value:this.props.value,css:se})}}]),a}(b.a.Component);ue.displayName="SelectOwners";var pe=Object(f.a)("div",{target:"ez8xng90",label:"Container"})({name:"gg4vpm",styles:"display:flex;justify-content:space-between;"}),de=Object(f.a)("div",{target:"ez8xng91",label:"DisabledLabel"})({name:"1bjwb34",styles:"opacity:0.5;overflow:hidden;"}),fe=Object(f.a)(v.a,{target:"ez8xng92",label:"AddToProjectButton"})({name:"6su6fj",styles:"flex-shrink:0;"}),he=n(10);function be(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var ge={text:"",tagName:"",type:"path",owners:[],isValid:!1};function me(e){switch(e){case"path":return"src/example/*";case"url":return"https://example.com/settings/*";case"tag":return"tag-value";default:return""}}var Oe=function(e){c()(a,e);var t,n=(t=a,function(){var e,n=d()(t);if(be()){var a=d()(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return u()(this,e)});function a(e){var t;return r()(this,a),(t=n.call(this,e)).checkIsValid=function(){t.setState((function(e){return{isValid:!!e.text&&e.owners&&!!e.owners.length}}))},t.handleTypeChange=function(e){t.setState({type:e}),t.checkIsValid()},t.handleTagNameChangeValue=function(e){t.setState({tagName:e.target.value},t.checkIsValid)},t.handleChangeValue=function(e){t.setState({text:e.target.value}),t.checkIsValid()},t.handleChangeOwners=function(e){t.setState({owners:e}),t.checkIsValid()},t.handleAddRule=function(){var e=t.state,n=e.type,a=e.text,r=e.tagName,i=e.owners;if(e.isValid){var o=i.map((function(e){return"team"===e.actor.type?"#".concat(e.actor.name):j.a.getById(e.actor.id).email})).join(" "),l=a.match(/\s/)?'"'.concat(a,'"'):a,c="".concat("tag"===n?"tags.".concat(r):n,":").concat(l," ").concat(o);t.props.onAddRule(c),t.setState(ge)}else Object(x.a)("A rule needs a type, a value, and one or more issue owners.")},t.handleSelectCandidate=function(e,n){t.setState({text:e,type:n}),t.checkIsValid()},t.state=ge,t}return o()(a,[{key:"render",value:function(){var e=this,t=this.props,n=t.urls,a=t.paths,r=t.disabled,i=t.project,o=t.organization,l=this.state,c=l.type,s=l.text,u=l.tagName,p=l.owners,d=l.isValid;return Object($.f)(b.a.Fragment,null,(a||n)&&Object($.f)(je,null,a&&a.map((function(t){return Object($.f)(xe,{key:t,onClick:function(){return e.handleSelectCandidate(t,"path")}},Object($.f)(we,{isCircled:!0}),Object($.f)(ve,null,t),Object($.f)(ye,null,"[PATH]"))})),n&&n.map((function(t){return Object($.f)(xe,{key:t,onClick:function(){return e.handleSelectCandidate(t,"url")}},Object($.f)(we,{isCircled:!0}),Object($.f)(ve,null,t),Object($.f)(ye,null,"[URL]"))}))),Object($.f)(Ce,null,Object($.f)(Se,{deprecatedSelectControl:!0,name:"select-type",value:c,showSearch:!1,onChange:this.handleTypeChange,options:[{value:"path",label:Object(w.b)("Path")},{value:"tag",label:Object(w.b)("Tag")},{value:"url",label:Object(w.b)("URL")}],style:{width:140},clearable:!1,disabled:r}),"tag"===c&&Object($.f)(Te,{controlled:!0,value:u,onChange:this.handleTagNameChangeValue,disabled:r,placeholder:"tag-name"}),Object($.f)(ke,{controlled:!0,value:s,onChange:this.handleChangeValue,disabled:r,placeholder:me(c)}),Object($.f)(Re,{src:"icon-chevron-right"}),Object($.f)(Ue,null,Object($.f)(ue,{organization:o,project:i,value:p,onChange:this.handleChangeOwners,disabled:r})),Object($.f)(Me,{priority:"primary",disabled:!d,onClick:this.handleAddRule,icon:Object($.f)(R.b,{size:"xs",isCircled:!0}),size:"small"})))}}]),a}(b.a.Component);Oe.displayName="RuleBuilder";var je=Object(f.a)("div",{target:"e1hyuoc70",label:"Candidates"})({name:"1r2f04i",styles:"margin-bottom:10px;"}),ye=Object(f.a)("div",{target:"e1hyuoc71",label:"TypeHint"})("color:",(function(e){return e.theme.borderDark}),";"),ve=Object(f.a)(k.b,{target:"e1hyuoc72",label:"StyledTextOverflow"})({name:"1rr4qq7",styles:"flex:1;"}),xe=Object(f.a)("div",{target:"e1hyuoc73",label:"RuleCandidate"})("font-family:",(function(e){return e.theme.text.familyMono}),";border:1px solid ",(function(e){return e.theme.borderDark}),";background-color:#f8fafd;padding-left:5px;margin-bottom:3px;cursor:pointer;overflow:hidden;display:flex;align-items:center;"),we=Object(f.a)(R.b,{target:"e1hyuoc74",label:"StyledIconAdd"})("color:",(function(e){return e.theme.borderDark}),";margin-right:5px;flex-shrink:0;"),Ce=Object(f.a)("div",{target:"e1hyuoc75",label:"BuilderBar"})("display:flex;height:40px;align-items:center;margin-bottom:",Object(he.a)(2),";"),Se=Object(f.a)(S.a,{target:"e1hyuoc76",label:"BuilderSelect"})("margin-right:",Object(he.a)(1.5),";width:50px;flex-shrink:0;"),ke=Object(f.a)(U.a,{target:"e1hyuoc77",label:"BuilderInput"})("padding:",Object(he.a)(1),";line-height:19px;margin-right:",Object(he.a)(.5),";"),Te=Object(f.a)(U.a,{target:"e1hyuoc78",label:"BuilderTagNameInput"})("padding:",Object(he.a)(1),";line-height:19px;margin-right:",Object(he.a)(.5),";width:200px;"),Re=Object(f.a)(T.a,{target:"e1hyuoc79",label:"Divider"})("color:",(function(e){return e.theme.borderDark}),";flex-shrink:0;margin-right:5px;"),Ue=Object(f.a)("div",{target:"e1hyuoc710",label:"SelectOwnersWrapper"})("display:flex;align-items:center;margin-right:",Object(he.a)(1),";"),Me=Object(f.a)(v.a,{target:"e1hyuoc711",label:"AddButton"})("padding:",Object(he.a)(.5),";"),Pe=Oe;function ze(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Ae=function(e){c()(a,e);var t,n=(t=a,function(){var e,n=d()(t);if(ze()){var a=d()(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return u()(this,e)});function a(e){var t;return r()(this,a),(t=n.call(this,e)).handleUpdateOwnership=function(){var e=t.props,n=e.organization,a=e.project,r=t.state.text;t.setState({error:null});var i=(new O.a).requestPromise("/projects/".concat(n.slug,"/").concat(a.slug,"/ownership/"),{method:"PUT",data:{raw:r||""}});return i.then((function(){Object(x.d)(Object(w.b)("Updated issue ownership rules")),t.setState({initialText:r})})).catch((function(e){t.setState({error:e.responseJSON}),403===e.status?Object(x.a)(Object(w.b)("You don't have permission to modify issue ownership rules for this project")):400===e.status&&e.responseJSON.raw&&e.responseJSON.raw[0].startsWith("Invalid rule owners:")?Object(x.a)(Object(w.b)("Unable to save issue ownership rule changes: "+e.responseJSON.raw[0])):Object(x.a)(Object(w.b)("Unable to save issue ownership rule changes"))})),i},t.handleChange=function(e){t.setState({text:e.target.value})},t.handleAddRule=function(e){t.setState((function(t){return{text:t.text+"\n"+e}}),t.handleUpdateOwnership)},t.state={text:e.initialText,initialText:e.initialText,error:null},t}return o()(a,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.initialText;t!==this.state.initialText&&this.setState({initialText:t})}},{key:"parseError",value:function(e){var t=e&&e.raw&&e.raw[0];return t?t.startsWith("Invalid rule owners:")?Object($.f)(Be,null,t):Object($.f)(De,{line:t.match(/line (\d*),/)[1]-1}):null}},{key:"mentionableUsers",value:function(){return j.a.getAll().map((function(e){return{id:e.id,display:e.email,email:e.email}}))}},{key:"mentionableTeams",value:function(){var e=this.props.project;return(y.a.getBySlug(e.slug)||{teams:[]}).teams.map((function(e){return{id:e.id,display:"#".concat(e.slug),email:e.id}}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.project,a=t.organization,r=t.disabled,i=t.urls,o=t.paths,l=this.state,c=l.text,s=l.error,u=l.initialText;return Object($.f)(b.a.Fragment,null,Object($.f)(Pe,{urls:i,paths:o,organization:a,project:n,onAddRule:this.handleAddRule.bind(this),disabled:r}),Object($.f)("div",{style:{position:"relative"},onKeyDown:function(t){t.metaKey&&"Enter"===t.key&&e.handleUpdateOwnership()}},Object($.f)(Ve,{placeholder:"#example usage\npath:src/example/pipeline/* person@sentry.io #infra\nurl:http://example.com/settings/* #product\ntags.sku_class:enterprise #enterprise",onChange:this.handleChange,disabled:r,value:c,spellCheck:"false",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"}),Object($.f)(Ie,null,Object($.f)("div",null,this.parseError(s)),Object($.f)(Ne,null,Object($.f)(v.a,{size:"small",priority:"primary",onClick:this.handleUpdateOwnership,disabled:r||c===u},Object(w.b)("Save Changes"))))))}}]),a}(b.a.Component);Ae.displayName="OwnerInput";var Ie=Object(f.a)("div",{target:"en3n9di0",label:"ActionBar"})({name:"1lekzkb",styles:"display:flex;align-items:center;justify-content:space-between;"}),De=Object(f.a)("div",{target:"en3n9di1",label:"SyntaxOverlay"})(C.a,";width:100%;height:",24,"px;background-color:red;opacity:0.1;pointer-events:none;position:absolute;top:",(function(e){return 4+24*e.line}),"px;"),Ne=Object(f.a)("div",{target:"en3n9di2",label:"SaveButton"})({name:"1lifesv",styles:"text-align:end;padding-top:10px;"}),Ve=Object(f.a)(m.a,{target:"en3n9di3",label:"StyledTextArea"})(C.a,";min-height:140px;overflow:auto;outline:0;width:100%;resize:none;margin:0;font-family:",(function(e){return e.theme.text.familyMono}),";word-break:break-all;white-space:pre-wrap;padding-top:",4,"px;line-height:",24,"px;"),Be=Object(f.a)("div",{target:"en3n9di4",label:"InvalidOwners"})("color:",(function(e){return e.theme.error}),";font-weight:bold;margin-top:12px;");t.a=Ae}}]);
//# sourceMappingURL=CreateOwnershipRuleModal~ProjectOwnership.js.map