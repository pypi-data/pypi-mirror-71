<div tal:define="oid oid|field.oid;
                 true_val true_val|field.widget.true_val;"
     tal:omit-tag="">
  ${field.start_mapping()}

  <div class="permissions-outer">

  <tal:loop tal:repeat="groupkey sorted(permissions, key=lambda k: permissions[k]['label'].lower())">
    <div tal:define="perms permissions[groupkey]['perms'];"
         class="permissions-group">
      <p class="group-label">${permissions[groupkey]['label']}</p>

      <tal:loop tal:repeat="key sorted(perms, key=lambda p: perms[p]['label'].lower())">
        <div class="perm">
          <label>
            <input type="checkbox"
                   name="${key}"
                   id="${oid}-${key}"
                   value="${true_val}"
                   tal:attributes="checked python:field.widget.get_checked_value(cstruct, key);" />
            ${perms[key]['label']}
          </label>
        </div>
      </tal:loop>

    </div>
  </tal:loop>

  </div>

  ${field.end_mapping()}
</div>
