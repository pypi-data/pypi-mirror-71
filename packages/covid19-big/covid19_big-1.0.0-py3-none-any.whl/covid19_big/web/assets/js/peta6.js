require(["esri/Map","esri/views/MapView","esri/layers/GeoJSONLayer","esri/layers/FeatureLayer","esri/widgets/TimeSlider","esri/widgets/Expand","esri/widgets/Home","esri/widgets/Legend","esri/widgets/LayerList","esri/widgets/BasemapGallery","esri/widgets/Fullscreen","esri/widgets/Zoom","esri/layers/MapImageLayer","esri/Graphic"],function(e,t,a,n,s,r,o,l,u,c,p,m,g){let f;var y="peta6_legend",w="https://portal.ina-sdi.or.id/gis/rest/services/COVID19/Statistik_prov/MapServer/1";var h=new XMLHttpRequest;h.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var a=JSON.parse(this.responseText),c=(N=a.features[0].attributes.tanggal,new Date(N).toISOString().substr(0,10)).split("-"),h=c[2],b=c[1]-1,L=c[0];test=new Date(L,b,h,7,0,0).toDateString().split(" ");var I=test[2]+" "+test[1]+" "+test[3];const A=new e({basemap:"dark-gray"});var E=new t({map:A,container:"peta-6",zoom:4,center:[117,-4]});E.ui.components=[];var x=new n({url:"https://services5.arcgis.com/VS6HdKS0VfIhv8Ct/arcgis/rest/services/COVID19_Indonesia_per_Provinsi/FeatureServer/0"});const R=new n({title:"COVID19 Indonesia",fields:[{name:"ObjectID",alias:"ObjectID",type:"oid"},{name:"provinsi",alias:"Provinsi",type:"string"},{name:"tanggal",alias:"Tanggal",type:"date"},{name:"akumulasi",alias:"Akumulasi",type:"integer"}],objectIdField:"ObjectID",geometryType:"point",spatialReference:{wkid:4326},source:[],timeInfo:{startField:"tanggal",interval:{unit:"days",value:1}},renderer:{type:"simple",field:"akumulasi",symbol:{type:"simple-marker",color:"orange",outline:null},visualVariables:[{type:"size",field:"akumulasi",stops:[{value:50,size:"3px"},{value:250,size:"8px"},{value:750,size:"13px"},{value:1e3,size:"28px"},{value:3e3,size:"40px"},{value:7e3,size:"65px"}]}]},popupTemplate:{title:"{provinsi}",content:[{type:"fields",fieldInfos:[{fieldName:"provinsi",label:"Provinsi",visible:!0},{fieldName:"akumulasi",label:"Akumulasi"},{fieldName:"tanggal",label:"Tanggal"}]}]}});A.add(R);var S=x.createQuery();S.where="Provinsi <> 'Indonesia'",S.outSpatialReference={wkid:4326},S.returnGeometry=!0,S.outFields=["Provinsi"],x.queryFeatures(S).then(function(e){for(console.log(e.features),data=[],i=0;i<e.features.length;i++)row={LATITUDE:e.features[i].geometry.latitude,LONGITUDE:e.features[i].geometry.longitude,PROVINSI:e.features[i].attributes.Provinsi},data.push(row);var t=new n({url:w});t.load().then(function(){var e=t.createQuery();e.where="nama_provinsi <> ''",t.queryFeatures(e).then(function(e){var t,a=[];for(i=0;i<e.features.length;i++){var n=data.filter(function(t){return"Sulawesi selatan"==e.features[i].attributes.nama_provinsi?nama_provinsi="Sulawesi Selatan":"Bangka Belitung"==e.features[i].attributes.nama_provinsi?nama_provinsi="Kepulauan Bangka Belitung":"Kepualauan Bangka Belitung"==e.features[i].attributes.nama_provinsi?nama_provinsi="Kepulauan Bangka Belitung":nama_provinsi=e.features[i].attributes.nama_provinsi,t.PROVINSI==nama_provinsi});t=new g({geometry:{type:"point",latitude:n[0].LATITUDE,longitude:n[0].LONGITUDE},attributes:{PROVINSI:e.features[i].attributes.nama_provinsi,TANGGAL:e.features[i].attributes.tanggal,AKUMULASI:e.features[i].attributes.akumulasi}}),a.push(t)}console.log(a);const r={addFeatures:a};R.applyEdits(r).then(function(e){if(e.addFeatureResults.length>0){var t=[];e.addFeatureResults.forEach(function(e){t.push(e.objectId)}),R.queryFeatures({objectIds:t}).then(function(e){console.log(e.features.length,"features have been added.")});var i=new s({mode:"instant",playRate:1200,stops:{interval:{value:1,unit:"days"}}}),a=document.getElementById("timeSlider");E.ui.add(a,"manual");var n=document.getElementById("timeRange");E.ui.add(n,"manual");var r=document.getElementById("prevBtn");r.classList.add("esri-component","esri-home","esri-widget--button","esri-widget"),r.setAttribute("title","Previous"),(u=document.createElement("span")).classList.add("esri-icon-reverse"),r.appendChild(u);var o=document.getElementById("playBtn");o.classList.add("esri-component","esri-home","esri-widget--button","esri-widget"),o.setAttribute("title","Play");var l=document.createElement("span");l.classList.add("esri-icon-play","toggle-icon"),o.appendChild(l);var u,c=document.getElementById("nextBtn");c.classList.add("esri-component","esri-home","esri-widget--button","esri-widget"),c.setAttribute("title","Next"),(u=document.createElement("span")).classList.add("esri-icon-forward"),c.appendChild(u);var p=document.getElementById("timeInfo");p.classList.add("esri-component","esri-widget");var m=document.getElementById("rangeInfo");m.classList.add("esri-component","esri-widget");var g=!1;o.addEventListener("click",function(e){g?(i.stop(),l.classList.remove("esri-icon-pause"),l.classList.add("esri-icon-play"),r.classList.remove("esri-button--disabled"),c.classList.remove("esri-button--disabled"),g=!1):(i.play(),l.classList.remove("esri-icon-play"),l.classList.add("esri-icon-pause"),r.classList.add("esri-button--disabled"),c.classList.add("esri-button--disabled"),g=!0)}),r.addEventListener("click",function(e){g||i.previous()}),c.addEventListener("click",function(e){g||i.next()}),E.whenLayerView(R).then(function(e){f=e;const t=new Date(2020,2,3,7,0,0),a=new Date(L,b,h,7,0,0);i.fullTimeExtent={start:t,end:a};const n=new Date(t);n.setDate(n.getDate()+1),i.values=[t],m.innerHTML="03 Mar 2020 - "+I,p.innerHTML="03 Mar 2020",R.definitionExpression="tanggal <= "+i.timeExtent.end.getTime()}),i.watch("values",function(e){v=e[0].toDateString(),d=v.split(" "),p.innerHTML=d[2]+" "+d[1]+" "+d[3]}),i.watch("timeExtent",function(){R.definitionExpression="tanggal = "+i.timeExtent.end.getTime(),f.effect={filter:{timeExtent:i.timeExtent,geometry:E.extent}}})}}).catch(function(e){console.log(e)})})})});var k=new o({view:E});E.ui.add(k,"top-right");var B=new m({view:E});E.ui.add(B,"bottom-right");var T=new u({container:document.createElement("div"),view:E,listItemCreatedFunction:function(e){e.item.actionsSections=[[{title:"URL service information",className:"esri-icon-description",id:"information"}]]}});T.on("trigger-action",function(e){var t=e.action.id;console.log(e.item.layer.url),"information"===t&&window.open(w)});var D=new r({expandIconClass:"esri-icon-layer-list",expandTooltip:"Expand LayerList",view:E,content:T.domNode});E.ui.add(D,"top-right");var _=document.createElement("div");_.style.width="185px",_.setAttribute("id",y);var O=document.createElement("i");O.classList.add("fa","fa-close","w3-right"),O.style.paddingTop="10px",O.style.paddingRight="10px",O.style.cursor="pointer",_.appendChild(O),O.addEventListener("click",function(e){document.getElementById(y).style.visibility="hidden"});new l({view:E,layerInfos:[{layer:R,title:"Covid19 Provinsi"}],container:_,style:"classic"});E.ui.add(_,"top-left");var C=document.createElement("div");C.classList.add("esri-component","esri-home","esri-widget--button","esri-widget"),C.setAttribute("title","Legend");var F=document.createElement("span");F.classList.add("esri-icon-documentation","toggle-icon"),C.appendChild(F),E.ui.add(C,"top-right"),C.addEventListener("click",function(e){var t;"hidden"===(t=document.getElementById(y)).style.visibility?t.style.visibility="visible":t.style.visibility="hidden"}),fullscreen=new p({view:E}),E.ui.add(fullscreen,"top-right")}var N},h.open("GET","https://portal.ina-sdi.or.id/gis/rest/services/COVID19/Statistik_prov/MapServer/1/query?where=1%3D1&outFields=*&returnCountOnly=false&orderByFields=tanggal+desc&resultRecordCount=1&f=json",!0),h.send()});