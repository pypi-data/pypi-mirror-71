(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{18:function(e,t,n){},29:function(e,t,n){e.exports=n(40)},34:function(e,t,n){},40:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(24),i=n.n(l),o=n(44),s=(n(34),n(6)),c=n(8),u=n(9),d=n(14),m=n(15),f=n(5);n(18);function p(e){var t=e.className,n=e.onClick,a=e.children;return r.a.createElement("button",Object.assign({onClick:n},{type:"button",className:"Link "+(t||"")}),a)}function y(e){var t=e.className,n=e.onClick,a=e.children;return r.a.createElement("button",Object.assign({onClick:n},{type:"button",className:"sLink material-icons "+(t||"")}),a)}var h=n(27);function v(e){var t=e.spaces;return t>0?Object(h.a)(Array(t)).map((function(e,t){return r.a.createElement("td",{className:"Empty",key:t})})):null}function g(e){var t=e.query,n=e.field,a=e.className,l=t.getField(n.path),i=t.getType(l);return r.a.createElement("th",{className:a},r.a.createElement(y,{onClick:function(){return t.removeField(n)}},"close"),l.canPivot&&r.a.createElement(r.a.Fragment,null,r.a.createElement(y,{onClick:function(){return t.togglePivot(n)}},n.pivoted?"call_received":"call_made")),l.concrete&&i.defaultLookup?r.a.createElement(r.a.Fragment,null,r.a.createElement(y,{onClick:function(){return t.addFilter(n.path,n.prettyPath)}},"filter_alt")," ",r.a.createElement(p,{onClick:function(){return t.toggleSort(n)}},n.prettyPath.join(" "),{dsc:"\u2191".concat(n.priority),asc:"\u2193".concat(n.priority),null:""}[n.sort])):" "+n.prettyPath.join(" "))}function E(e){var t,n=e.query,a=e.field,l=e.className,i=e.span,o=e.value,s=n.getField(a.path);return t=void 0===o?"":"html"===s.type&&o?r.a.createElement("div",{dangerouslySetInnerHTML:{__html:o}}):String(o),r.a.createElement("td",{className:s.type+" "+l||"",colSpan:i||1},t)}function k(e){var t=e.fields,n=e.query,a=e.classNameFirst;return t.map((function(e,t){return r.a.createElement(g,Object.assign({query:n,field:e},{key:e.pathStr,className:"HoriBorder "+(t?"":a)}))}))}function b(e){var t=e.fields,n=e.query,a=e.classNameFirst,l=e.row;return t.map((function(e,t){return r.a.createElement(E,Object.assign({query:n,field:e},{key:e.pathStr,value:l[e.pathStr],className:t?"":a}))}))}function F(e){var t=e.query,n=e.field,a=e.data,l=e.span;return r.a.createElement(r.a.Fragment,null,r.a.createElement(g,{query:t,field:n}),a.map((function(e,a){return r.a.createElement(E,Object.assign({key:a,query:t,field:n,span:l},{value:e[n.pathStr]}))})))}function j(e){var t=e.query,n=e.cols,a=e.rows,l=e.body;return r.a.createElement("table",{className:"Results"},r.a.createElement("thead",null,t.colFields().map((function(e){return r.a.createElement("tr",{key:e.pathStr},r.a.createElement(v,{spaces:t.rowFields().length-1}),r.a.createElement(F,Object.assign({query:t,field:e},{span:t.resFields().length,data:n})))})),r.a.createElement("tr",null,r.a.createElement(v,{spaces:1-t.rowFields().length}),r.a.createElement(k,Object.assign({query:t},{fields:t.rowFields()})),n.map((function(e,n){return r.a.createElement(k,Object.assign({key:n,query:t},{fields:t.resFields(),classNameFirst:"LeftBorder"}))})))),r.a.createElement("tbody",null,a.map((function(e,n){return r.a.createElement("tr",{key:n},r.a.createElement(v,{spaces:1-t.rowFields().length}),r.a.createElement(b,Object.assign({query:t,row:e},{fields:t.rowFields()})),l.map((function(e,a){return r.a.createElement(b,Object.assign({key:a,query:t},{fields:t.resFields(),row:e[n],classNameFirst:"LeftBorder"}))})))}))))}function q(e){var t=e.lookup,n=e.onChange,a=e.value;return"boolean"===e.lookup.type?r.a.createElement("select",Object.assign({onChange:n,value:a},{className:"FilterValue"}),r.a.createElement("option",{value:!0},"true"),r.a.createElement("option",{value:!1},"false")):"weekday"===t.type?r.a.createElement("select",Object.assign({onChange:n,value:a},{className:"FilterValue"}),["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map((function(e){return r.a.createElement("option",{value:e},e)}))):"month"===t.type?r.a.createElement("select",Object.assign({onChange:n,value:a},{className:"FilterValue"}),["January","Febuary","March","April","May","June","July","August","September","October","November","December"].map((function(e){return r.a.createElement("option",{value:e},e)}))):"number"===t.type||"year"===t.type?r.a.createElement("input",Object.assign({onChange:n,value:a},{className:"FilterValue",type:"number",step:"0"})):r.a.createElement("input",Object.assign({onChange:n,value:a},{className:"FilterValue",type:"text"}))}var O=function(e){Object(m.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props,t=e.path,n=e.prettyPath,a=e.index,l=e.lookup,i=e.query,o=e.value,s=e.errorMessage,c=i.getType(i.getField(t));return r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement(y,{onClick:function(){return i.removeFilter(a)}},"close")," ",r.a.createElement(p,{onClick:function(){return i.addField(t,n)}},n.join(" "))," "),r.a.createElement("td",null,r.a.createElement("select",{className:"Lookup",value:l,onChange:function(e){return i.setFilterLookup(a,e.target.value)}},c.sortedLookups.map((function(e){return r.a.createElement("option",{key:e,value:e},e.replace(/_/g," "))})))),r.a.createElement("td",null,"="),r.a.createElement("td",null,r.a.createElement(q,Object.assign({value:o},{onChange:function(e){return i.setFilterValue(a,e.target.value)},lookup:c.lookups[l]})),s&&r.a.createElement("p",null,s)))}}]),n}(r.a.Component);function w(e){var t=e.query,n=e.filterErrors;return r.a.createElement("form",{className:"Filters"},r.a.createElement("table",{className:"Flat"},r.a.createElement("tbody",null,e.filters.map((function(e,a){return r.a.createElement(O,Object.assign({query:t,index:a},e,{key:a,errorMessage:n[a]}))})))))}var S=function(e){Object(m.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={toggled:!1},a}return Object(u.a)(n,[{key:"toggle",value:function(){this.setState((function(e){return{toggled:!e.toggled}}))}},{key:"render",value:function(){var e=this.props,t=e.query,n=e.path,a=e.prettyPath,l=e.modelField,i=t.getType(l);return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null,l.concrete&&i.defaultLookup&&r.a.createElement(y,{onClick:function(){return t.addFilter(n,a)}},"filter_alt")),r.a.createElement("td",null,l.model&&r.a.createElement(y,{className:"ToggleLink",onClick:this.toggle.bind(this)},this.state.toggled?"remove":"add")),r.a.createElement("td",null,l.type?r.a.createElement(p,{onClick:function(){return t.addField(n,a)}},l.prettyName):l.prettyName)),this.state.toggled&&r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:"2"},r.a.createElement(N,Object.assign({query:t,path:n,prettyPath:a},{model:l.model})))))}}]),n}(r.a.Component);function N(e){var t=e.query,n=e.model,a=e.path,l=e.prettyPath,i=t.getModelFields(n);return r.a.createElement("table",null,r.a.createElement("tbody",null,i.sortedFields.map((function(e){var n=i.fields[e];return r.a.createElement(S,Object.assign({key:e},{query:t,modelField:n},{path:a.concat([e]),prettyPath:l.concat([n.prettyName])}))}))))}function C(e){return r.a.createElement("select",{className:"ModelSelector",onChange:function(t){return e.query.setModel(t.target.value)},value:e.model},e.sortedModels.map((function(e){return r.a.createElement("option",{key:e},e)})))}function M(e){return r.a.createElement("div",{className:"Logo",onClick:function(){return e.query.setModel("")}},r.a.createElement("span",null,"DDB"),r.a.createElement("span",{className:"Version"},"v",e.version))}function L(e){var t=e.query,n=e.rows,a=e.cols,l=e.body,i=e.version,o=e.sortedModels,s=e.model,c=e.filters,u=e.filterErrors,d=t.getUrlForSave();return r.a.createElement("div",{id:"body"},r.a.createElement(M,{query:t,version:i}),r.a.createElement(C,{query:t,sortedModels:o,model:s}),r.a.createElement(w,{query:t,filters:c,filterErrors:u}),r.a.createElement("p",null,"Showing ",n.length*a.length," results -"," ",r.a.createElement("a",{href:t.getUrlForMedia("csv")},"Download as CSV")," -"," ",r.a.createElement("a",{href:t.getUrlForMedia("json")},"View as JSON"),d&&r.a.createElement(r.a.Fragment,null," ","- ",r.a.createElement("a",{href:d},"Save View")," ")),r.a.createElement("div",{className:"MainSpace"},r.a.createElement("div",{className:"FieldsList"},r.a.createElement(N,Object.assign({query:t,model:s},{path:[],prettyPath:[]}))),t.rowFields().length||t.colFields().length?r.a.createElement(j,{query:t,rows:n,cols:a,body:l}):r.a.createElement("h2",null,"No fields selected")))}function V(e){var t=e.query,n=e.version,a=e.sortedModels,l=e.savedViews;return r.a.createElement("div",{id:"body"},r.a.createElement(M,{query:t,version:n}),r.a.createElement("div",{className:"Index"},r.a.createElement("div",null,r.a.createElement("h1",null,"Models"),r.a.createElement("div",null,a.map((function(e){return r.a.createElement("div",{key:e},r.a.createElement("button",{className:"Link",onClick:function(){return t.setModel(e)}},e))})))),r.a.createElement("div",null,r.a.createElement("h1",null,"Saved Views"),r.a.createElement("div",null,l.map((function(e,n){return r.a.createElement("div",{key:n},r.a.createElement("button",{className:"Link",onClick:function(){return t.setQuery(e.query)}},e.model," - ",e.name),r.a.createElement("p",null,e.description))}))))))}var P=n(25),_={rows:[{}],cols:[{}],body:[[{}]],filterErrors:[]};function Q(e){return{model:e.model,fields:e.fields.map((function(e){return(e.pivoted?"&":"")+e.path.join("__")+{asc:"+".concat(e.priority),dsc:"-".concat(e.priority),null:""}[e.sort]})).join(","),query:e.filters.map((function(e){return"".concat(e.path.join("__"),"__").concat(e.lookup,"=").concat(e.value)})).join("&")}}function U(e,t,n){var a=Q(t),r="".concat(e,"query/").concat(a.model);return"".concat(window.location.origin).concat(r,"/").concat(a.fields,".").concat(n,"?").concat(a.query)}var D,T=function(){function e(t,n,a){Object(c.a)(this,e),this.config=t,this.query=n,this.setQuery=a}return Object(u.a)(e,[{key:"getField",value:function(e){var t,n=e.slice(-1),a=this.query.model,r=Object(P.a)(e.slice(0,-1));try{for(r.s();!(t=r.n()).done;){var l=t.value;a=this.config.allModelFields[a].fields[l].model}}catch(i){r.e(i)}finally{r.f()}return this.config.allModelFields[a].fields[n]}},{key:"getType",value:function(e){return this.config.types[e.type]}},{key:"getModelFields",value:function(e){return this.config.allModelFields[e]}},{key:"getDefaultLookupValue",value:function(e,t){return this.config.types[e.lookups[t].type].defaultValue}},{key:"addField",value:function(e,t){var n=this.query.fields.slice();n.push({path:e,pathStr:e.join("__"),prettyPath:t,sort:null,priority:null,pivoted:!1}),this.setQuery({fields:n})}},{key:"removeField",value:function(e){this.setQuery({fields:this.query.fields.filter((function(t){return t.pathStr!==e.pathStr}))})}},{key:"toggleSort",value:function(e){var t=this.query.fields.findIndex((function(t){return t.pathStr===e.pathStr})),n={asc:"dsc",dsc:null,null:"asc"}[e.sort],a=this.query.fields.slice();e.sort&&(a=a.map((function(t){return Object(s.a)({},t,{priority:null!=t.priority&&t.priority>e.priority?t.priority-1:t.priority})}))),n?(a=a.map((function(e){return Object(s.a)({},e,{priority:null!=e.priority?e.priority+1:e.priority})})))[t]=Object(s.a)({},e,{sort:n,priority:0}):a[t]=Object(s.a)({},e,{sort:null,priority:null}),this.setQuery({fields:a})}},{key:"togglePivot",value:function(e){var t=this.query.fields.findIndex((function(t){return t.pathStr===e.pathStr})),n=this.query.fields.slice();n[t].pivoted=!n[t].pivoted,this.setQuery({fields:n})}},{key:"addFilter",value:function(e,t){var n=this.getType(this.getField(e)),a=this.query.filters.slice();a.push({path:e,pathStr:e.join("__"),prettyPath:t,lookup:n.defaultLookup,value:this.getDefaultLookupValue(n,n.defaultLookup)}),this.setQuery({filters:a})}},{key:"removeFilter",value:function(e){var t=this.query.filters.slice();t.splice(e,1),this.setQuery({filters:t})}},{key:"setFilterValue",value:function(e,t){var n=this.query.filters.slice();n[e]=Object(s.a)({},n[e],{value:t}),this.setQuery({filters:n})}},{key:"setFilterLookup",value:function(e,t){var n=this.query.filters.slice(),a=n[e],r=this.getType(this.getField(n[e].path));r.lookups[a.lookup].type!==r.lookups[t].type&&(a.value=this.getDefaultLookupValue(r,t)),a.lookup=t,this.setQuery({filters:n})}},{key:"setModel",value:function(e){this.setQuery(Object(s.a)({model:e,fields:[],filters:[]},_))}},{key:"getUrlForSave",value:function(){if(null===this.config.adminUrl)return null;var e=Q(this.query);e.model_name=e.model;var t=new URLSearchParams(e).toString();return"".concat(window.location.origin).concat(this.config.adminUrl,"?").concat(t)}},{key:"getUrlForMedia",value:function(e){return U(this.config.baseUrl,this.query,e)}},{key:"colFields",value:function(){return this.query.fields.filter((function(e){return e.pivoted}))}},{key:"rowFields",value:function(){var e=this;return this.colFields().length?this.query.fields.filter((function(t){return!t.pivoted&&e.getField(t.path).canPivot})):this.query.fields}},{key:"resFields",value:function(){var e=this;return this.colFields().length?this.query.fields.filter((function(t){return!e.getField(t.path).canPivot})):[]}}]),e}(),x=n(35);function B(e){"AbortError"===e.name?console.log("request aborted"):(console.log(e),f.a(e))}var J=function(e){Object(m.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state=e.initialState,a}return Object(u.a)(n,[{key:"fetchResults",value:function(e){var t=this,n=U(this.props.config.baseUrl,e,"json");return D&&D.abort(),D=new AbortController,e.model?fetch(n,{signal:D.signal}).then((function(e){return e.json()})).then((function(e){return e.version!==t.state.version&&window.location.reload(!0),delete e.version,e})).then((function(e){return t.setState({body:e.body,cols:e.cols,rows:e.rows,filterErrors:e.filterErrors}),e})):Promise.resolve(Object(s.a)({model:"",fields:[],filters:[]},_))}},{key:"componentDidMount",value:function(){var e=this,t=Object(s.a)({model:this.state.model,fields:this.state.fields,filters:this.state.filters},_);window.history.replaceState(t,null,U(this.props.config.baseUrl,this.state,"html")),this.fetchResults(this.state).catch(B),window.onpopstate=function(t){e.fetchResults(t.state).catch(B),e.setState(t.state)}}},{key:"handleQueryChange",value:function(e){this.setState(e);var t=Object(s.a)({},this.state,{},e),n=Object(s.a)({model:t.model,fields:t.fields,filters:t.filters},_);window.history.pushState(n,null,U(this.props.config.baseUrl,t,"html")),this.fetchResults(t).then((function(e){e=Object(s.a)({},e,{},_),x.deepEqual(e,n)})).catch(B)}},{key:"render",value:function(){var e=new T(this.props.config,this.state,this.handleQueryChange.bind(this));return this.state.model?r.a.createElement(L,Object.assign({query:e,sortedModels:this.props.config.sortedModels,version:this.props.config.version},this.state)):r.a.createElement(V,{query:e,sortedModels:this.props.config.sortedModels,savedViews:this.props.config.savedViews,version:this.props.config.version})}}]),n}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var I=JSON.parse(document.getElementById("django-data").textContent);I.sentryDsn&&o.a({dsn:I.sentryDsn,release:I.config.version,attachStacktrace:!0}),i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(J,I)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[29,1,2]]]);
//# sourceMappingURL=main.23fbf32b.chunk.js.map