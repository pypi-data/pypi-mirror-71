(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{18:function(e,t,r){},29:function(e,t,r){e.exports=r(40)},34:function(e,t,r){},40:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),l=r(24),i=r.n(l),o=r(44),s=(r(34),r(6)),u=r(8),c=r(9),d=r(14),f=r(15),y=r(5);r(18);function m(e){return a.a.createElement("button",{type:"button",className:"Link "+(e.className||""),onClick:e.onClick},e.children)}var p=r(27);function h(e){return e.spaces>0?Object(p.a)(Array(e.spaces)).map((function(e,t){return a.a.createElement("td",{className:"Empty",key:t})})):null}function v(e){var t=e.query.getField(e.field.path),r=e.query.getType(t);return a.a.createElement("th",{className:e.className},a.a.createElement(m,{onClick:function(){return e.query.removeField(e.field)}},"\u2718")," ",t.canPivot?a.a.createElement(a.a.Fragment,null,a.a.createElement(m,{onClick:function(){return e.query.togglePivot(e.field)}},e.field.pivoted?"\u2ba6":"\u2ba5")," "):"",t.concrete&&r.defaultLookup?a.a.createElement(a.a.Fragment,null,a.a.createElement(m,{onClick:function(){return e.query.addFilter(e.field.path,e.field.prettyPath)}},"Y")," ",a.a.createElement(m,{onClick:function(){return e.query.toggleSort(e.field)}},e.field.prettyPath.join(" "))," ",{dsc:"\u2191".concat(e.field.priority),asc:"\u2193".concat(e.field.priority),null:""}[e.field.sort]):e.field.prettyPath.join(" "))}function g(e){var t,r=e.query.getField(e.field.path);return t=void 0===e.value?"":"html"===r.type&&e.value?a.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.value}}):String(e.value),a.a.createElement("td",{className:r.type+" "+e.className||"",colSpan:e.span||1},t)}function E(e){return e.fields.map((function(t,r){return a.a.createElement(v,{query:e.query,field:t,index:r,key:t.pathStr,className:"HoriBorder "+(r?"":e.classNameFirst)})}))}function q(e){return e.fields.map((function(t,r){return a.a.createElement(g,{key:t.pathStr,query:e.query,value:e.row[t.pathStr],field:t,className:r?"":e.classNameFirst})}))}function k(e){return a.a.createElement(a.a.Fragment,null,a.a.createElement(v,{query:e.query,field:e.field,index:0}),e.data.map((function(t,r){return a.a.createElement(g,{key:r,query:e.query,value:t[e.field.pathStr],field:e.field,span:e.span})})))}function F(e){return a.a.createElement("table",{className:"Results"},a.a.createElement("thead",null,e.query.colFields().map((function(t){return a.a.createElement("tr",{key:t.pathStr},a.a.createElement(h,{spaces:e.query.rowFields().length-1}),a.a.createElement(k,{query:e.query,field:t,span:e.query.resFields().length,data:e.cols}))})),a.a.createElement("tr",null,a.a.createElement(h,{spaces:1-e.query.rowFields().length}),a.a.createElement(E,{query:e.query,fields:e.query.rowFields()}),e.cols.map((function(t,r){return a.a.createElement(E,{key:r,query:e.query,fields:e.query.resFields(),classNameFirst:"LeftBorder"})})))),a.a.createElement("tbody",null,e.rows.map((function(t,r){return a.a.createElement("tr",{key:r},a.a.createElement(h,{spaces:1-e.query.rowFields().length}),a.a.createElement(q,{query:e.query,fields:e.query.rowFields(),row:t}),e.body.map((function(t,n){return a.a.createElement(q,{key:n,query:e.query,fields:e.query.resFields(),row:t[r],classNameFirst:"LeftBorder"})})))}))))}function b(e){return"boolean"===e.lookup.type?a.a.createElement("select",{className:"FilterValue",onChange:e.onChange,value:e.value},a.a.createElement("option",{value:!0},"true"),a.a.createElement("option",{value:!1},"false")):"weekday"===e.lookup.type?a.a.createElement("select",{className:"FilterValue",onChange:e.onChange,value:e.value},["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map((function(e){return a.a.createElement("option",{value:e},e)}))):"month"===e.lookup.type?a.a.createElement("select",{className:"FilterValue",onChange:e.onChange,value:e.value},["January","Febuary","March","April","May","June","July","August","September","October","November","December"].map((function(e){return a.a.createElement("option",{value:e},e)}))):"number"===e.lookup.type?a.a.createElement("input",{className:"FilterValue",type:"number",step:"0",value:e.value,onChange:e.onChange}):a.a.createElement("input",{className:"FilterValue",type:"text",value:e.value,onChange:e.onChange})}var w=function(e){Object(f.a)(r,e);var t=Object(d.a)(r);function r(){return Object(u.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"render",value:function(){var e=this.props.path,t=this.props.prettyPath,r=this.props.index,n=this.props.lookup,l=this.props.query,i=l.getType(l.getField(e));return a.a.createElement("tr",null,a.a.createElement("td",null,a.a.createElement(m,{onClick:function(){return l.removeFilter(r)}},"\u2718")," ",a.a.createElement(m,{onClick:function(){return l.addField(e,t)}},t.join(" "))," "),a.a.createElement("td",null,a.a.createElement("select",{className:"Lookup",value:n,onChange:function(e){return l.setFilterLookup(r,e.target.value)}},i.sortedLookups.map((function(e){return a.a.createElement("option",{key:e,value:e},e.replace(/_/g," "))})))),a.a.createElement("td",null,"="),a.a.createElement("td",null,a.a.createElement(b,{value:this.props.value,onChange:function(e){return l.setFilterValue(r,e.target.value)},lookup:i.lookups[n]}),this.props.errorMessage?a.a.createElement("p",null,this.props.errorMessage):""))}}]),r}(a.a.Component);function j(e){return a.a.createElement("form",{className:"Filters"},a.a.createElement("table",{className:"Flat"},a.a.createElement("tbody",null,e.filters.map((function(t,r){return a.a.createElement(w,Object.assign({query:e.query,key:r,index:r},t,{errorMessage:e.filterErrors[r]}))})))))}var S=function(e){Object(f.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).state={isToggleOn:!1},n}return Object(c.a)(r,[{key:"handleClick",value:function(){this.setState((function(e){return{isToggleOn:!e.isToggleOn}}))}},{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement("td",null,a.a.createElement(m,{className:"ToggleLink",onClick:this.handleClick.bind(this)},this.state.isToggleOn?">":"+")),a.a.createElement("td",null,this.props.title,this.state.isToggleOn&&this.props.children))}}]),r}(a.a.Component);function N(e){var t=e.modelField,r=t.type?a.a.createElement(m,{onClick:function(){return e.query.addField(e.path,e.prettyPath)}},t.prettyName):t.prettyName,n=e.query.getType(t);return a.a.createElement("tr",null,a.a.createElement("td",null,t.concrete&&n.defaultLookup&&a.a.createElement(m,{onClick:function(){return e.query.addFilter(e.path,e.prettyPath)}},"Y")),t.model?a.a.createElement(S,{title:r},a.a.createElement(C,{query:e.query,model:t.model,path:e.path,prettyPath:e.prettyPath})):a.a.createElement(a.a.Fragment,null,a.a.createElement("td",null),a.a.createElement("td",null,r)))}function C(e){var t=e.query.getModelFields(e.model);return a.a.createElement("table",null,a.a.createElement("tbody",null,t.sortedFields.map((function(r){var n=t.fields[r];return a.a.createElement(N,{key:r,query:e.query,path:e.path.concat([r]),prettyPath:e.prettyPath.concat([n.prettyName]),modelField:n})}))))}function O(e){return a.a.createElement("select",{className:"ModelSelector",onChange:function(t){return e.query.setModel(t.target.value)},value:e.model},e.sortedModels.map((function(e){return a.a.createElement("option",{key:e},e)})))}function M(e){return a.a.createElement("div",{className:"Logo",onClick:function(){return e.query.setModel("")}},a.a.createElement("span",null,"DDB"),a.a.createElement("span",{className:"Version"},"v",e.version))}function L(e){var t=e.query.getUrlForSave();return a.a.createElement("div",{id:"body"},a.a.createElement(M,{query:e.query,version:e.version}),a.a.createElement(O,{query:e.query,sortedModels:e.sortedModels,model:e.model}),a.a.createElement(j,{query:e.query,filters:e.filters,filterErrors:e.filterErrors}),a.a.createElement("p",null,"Showing ",e.rows.length*e.cols.length," results -"," ",a.a.createElement("a",{href:e.query.getUrlForMedia("csv")},"Download as CSV")," -"," ",a.a.createElement("a",{href:e.query.getUrlForMedia("json")},"View as JSON"),t&&a.a.createElement(a.a.Fragment,null," ","- ",a.a.createElement("a",{href:t},"Save View")," ")),a.a.createElement("div",{className:"MainSpace"},a.a.createElement("div",{className:"FieldsList"},a.a.createElement(C,{query:e.query,model:e.model,path:[],prettyPath:[]})),e.query.rowFields().length||e.query.colFields().length?a.a.createElement(F,{query:e.query,rows:e.rows,cols:e.cols,body:e.body}):a.a.createElement("h2",null,"No fields selected")))}function P(e){return a.a.createElement("div",{id:"body"},a.a.createElement(M,{query:e.query,version:e.version}),a.a.createElement("div",{className:"Index"},a.a.createElement("div",null,a.a.createElement("h1",null,"Models"),a.a.createElement("div",null,e.sortedModels.map((function(t){return a.a.createElement("div",{key:t},a.a.createElement("button",{className:"Link",onClick:function(){return e.query.setModel(t)}},t))})))),a.a.createElement("div",null,a.a.createElement("h1",null,"Saved Views"),a.a.createElement("div",null,e.savedViews.map((function(t,r){return a.a.createElement("div",{key:r},a.a.createElement("button",{className:"Link",onClick:function(){return e.query.setQuery(t.query)}},t.model," - ",t.name),a.a.createElement("p",null,t.description))}))))))}var V=r(25),T={rows:[{}],cols:[{}],body:[[{}]],filterErrors:[]};function _(e){return{model:e.model,fields:e.fields.map((function(e){return(e.pivoted?"&":"")+e.path.join("__")+{asc:"+".concat(e.priority),dsc:"-".concat(e.priority),null:""}[e.sort]})).join(","),query:e.filters.map((function(e){return"".concat(e.path.join("__"),"__").concat(e.lookup,"=").concat(e.value)})).join("&")}}function Q(e,t,r){var n=_(t),a="".concat(e,"query/").concat(n.model);return"".concat(window.location.origin).concat(a,"/").concat(n.fields,".").concat(r,"?").concat(n.query)}var U,x=function(){function e(t,r,n){Object(u.a)(this,e),this.config=t,this.query=r,this.setQuery=n}return Object(c.a)(e,[{key:"getField",value:function(e){var t,r=e.slice(-1),n=this.query.model,a=Object(V.a)(e.slice(0,-1));try{for(a.s();!(t=a.n()).done;){var l=t.value;n=this.config.allModelFields[n].fields[l].model}}catch(i){a.e(i)}finally{a.f()}return this.config.allModelFields[n].fields[r]}},{key:"getType",value:function(e){return this.config.types[e.type]}},{key:"getModelFields",value:function(e){return this.config.allModelFields[e]}},{key:"getDefaultLookupValue",value:function(e,t){return this.config.types[e.lookups[t].type].defaultValue}},{key:"addField",value:function(e,t){var r=this.query.fields.slice();r.push({path:e,pathStr:e.join("__"),prettyPath:t,sort:null,priority:null,pivoted:!1}),this.setQuery({fields:r})}},{key:"removeField",value:function(e){this.setQuery({fields:this.query.fields.filter((function(t){return t.pathStr!==e.pathStr}))})}},{key:"toggleSort",value:function(e){var t=this.query.fields.findIndex((function(t){return t.pathStr===e.pathStr})),r={asc:"dsc",dsc:null,null:"asc"}[e.sort],n=this.query.fields.slice();e.sort&&(n=n.map((function(t){return Object(s.a)({},t,{priority:null!=t.priority&&t.priority>e.priority?t.priority-1:t.priority})}))),r?(n=n.map((function(e){return Object(s.a)({},e,{priority:null!=e.priority?e.priority+1:e.priority})})))[t]=Object(s.a)({},e,{sort:r,priority:0}):n[t]=Object(s.a)({},e,{sort:null,priority:null}),this.setQuery({fields:n})}},{key:"togglePivot",value:function(e){var t=this.query.fields.findIndex((function(t){return t.pathStr===e.pathStr})),r=this.query.fields.slice();r[t].pivoted=!r[t].pivoted,this.setQuery({fields:r})}},{key:"addFilter",value:function(e,t){var r=this.getType(this.getField(e)),n=this.query.filters.slice();n.push({path:e,pathStr:e.join("__"),prettyPath:t,lookup:r.defaultLookup,value:this.getDefaultLookupValue(r,r.defaultLookup)}),this.setQuery({filters:n})}},{key:"removeFilter",value:function(e){var t=this.query.filters.slice();t.splice(e,1),this.setQuery({filters:t})}},{key:"setFilterValue",value:function(e,t){var r=this.query.filters.slice();r[e]=Object(s.a)({},r[e],{value:t}),this.setQuery({filters:r})}},{key:"setFilterLookup",value:function(e,t){var r=this.query.filters.slice(),n=r[e],a=this.getType(this.getField(r[e].path));a.lookups[n.lookup].type!==a.lookups[t].type&&(n.value=this.getDefaultLookupValue(a,t)),n.lookup=t,this.setQuery({filters:r})}},{key:"setModel",value:function(e){this.setQuery(Object(s.a)({model:e,fields:[],filters:[]},T))}},{key:"getUrlForSave",value:function(){if(null===this.config.adminUrl)return null;var e=_(this.query);e.model_name=e.model;var t=new URLSearchParams(e).toString();return"".concat(window.location.origin).concat(this.config.adminUrl,"?").concat(t)}},{key:"getUrlForMedia",value:function(e){return Q(this.config.baseUrl,this.query,e)}},{key:"colFields",value:function(){return this.query.fields.filter((function(e){return e.pivoted}))}},{key:"rowFields",value:function(){var e=this;return this.colFields().length?this.query.fields.filter((function(t){return!t.pivoted&&e.getField(t.path).canPivot})):this.query.fields}},{key:"resFields",value:function(){var e=this;return this.colFields().length?this.query.fields.filter((function(t){return!e.getField(t.path).canPivot})):[]}}]),e}(),D=r(35);function B(e){"AbortError"===e.name?console.log("request aborted"):(console.log(e),y.a(e))}var J=function(e){Object(f.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).state=e.initialState,n}return Object(c.a)(r,[{key:"fetchResults",value:function(e){var t=this,r=Q(this.props.config.baseUrl,e,"json");return U&&U.abort(),U=new AbortController,e.model?fetch(r,{signal:U.signal}).then((function(e){return e.json()})).then((function(e){return e.version!==t.state.version&&window.location.reload(!0),delete e.version,e})).then((function(e){return t.setState({body:e.body,cols:e.cols,rows:e.rows,filterErrors:e.filterErrors}),e})):Promise.resolve(Object(s.a)({model:"",fields:[],filters:[]},T))}},{key:"componentDidMount",value:function(){var e=this,t=Object(s.a)({model:this.state.model,fields:this.state.fields,filters:this.state.filters},T);window.history.replaceState(t,null,Q(this.props.config.baseUrl,this.state,"html")),this.fetchResults(this.state).catch(B),window.onpopstate=function(t){e.fetchResults(t.state).catch(B),e.setState(t.state)}}},{key:"handleQueryChange",value:function(e){this.setState(e);var t=Object(s.a)({},this.state,{},e),r=Object(s.a)({model:t.model,fields:t.fields,filters:t.filters},T);window.history.pushState(r,null,Q(this.props.config.baseUrl,t,"html")),this.fetchResults(t).then((function(e){e=Object(s.a)({},e,{},T),D.deepEqual(e,r)})).catch(B)}},{key:"render",value:function(){var e=new x(this.props.config,this.state,this.handleQueryChange.bind(this));return this.state.model?a.a.createElement(L,Object.assign({query:e,sortedModels:this.props.config.sortedModels,version:this.props.config.version},this.state)):a.a.createElement(P,{query:e,sortedModels:this.props.config.sortedModels,savedViews:this.props.config.savedViews,version:this.props.config.version})}}]),r}(a.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var I=JSON.parse(document.getElementById("django-data").textContent);I.sentryDsn&&o.a({dsn:I.sentryDsn,release:I.config.version,attachStacktrace:!0}),i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(J,I)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[29,1,2]]]);
//# sourceMappingURL=main.c9c293a2.chunk.js.map